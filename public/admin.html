<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Luna Admin Panel</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial,sans-serif;background:#1e1e1e;color:#eee;margin:0;padding:20px}
    .card{background:#2c2c2c;border-radius:10px;padding:16px;max-width:720px}
    input,select,button{padding:10px;border-radius:8px;border:1px solid #444;background:#1f1f1f;color:#eee}
    button{background:#5c5cff;border:none;cursor:pointer}
    label{display:block;margin-top:10px}
  </style>
</head>
<body>
  <h2>‚öôÔ∏è Luna Admin Panel</h2>
  <div class="card">
    <label>Personality
      <input id="personality" placeholder="friendly, witty, serious‚Ä¶" />
    </label>

    <label>Default Voice
      <select id="voice">
        <option value="alloy">Alloy</option>
        <option value="verse">Verse</option>
        <option value="soft">Soft</option>
        <option value="energetic">Energetic</option>
        <option value="robotic">Robotic</option>
      </select>
    </label>

    <label>Global Background
      <select id="background">
        <option value="default">Default</option>
        <option value="space">Space</option>
        <option value="forest">Forest</option>
        <option value="neon">Neon</option>
      </select>
    </label>

    <label>Default Avatar Skin
      <select id="avatar">
        <option value="neo">Neo</option>
        <option value="pearl">Pearl</option>
        <option value="onyx">Onyx</option>
      </select>
    </label>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <button onclick="saveConfig()">üíæ Save</button>
      <button onclick="testVoice()">üîä Test Voice</button>
      <span id="status" style="margin-left:8px"></span>
    </div>
  </div>

  <script>
    async function saveConfig(){
      const payload = {
        personality: document.getElementById("personality").value,
        voice: document.getElementById("voice").value,
        background: document.getElementById("background").value,
        avatar: document.getElementById("avatar").value
      };
      const res = await fetch("/config", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      document.getElementById("status").textContent = "Saved ‚úî " + new Date().toLocaleTimeString();
    }

    async function testVoice(){
      const voice = document.getElementById("voice").value;
      const res = await fetch("/test-voice", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ voice })
      });
      const data = await res.json();
      if (data.audio) {
        new Audio("data:audio/mpeg;base64," + data.audio).play();
      } else {
        alert("Error: " + (data.error || "unknown"));
      }
    }

    // load current
    fetch("/config").then(r=>r.json()).then(cfg=>{
      document.getElementById("personality").value = cfg.personality || "";
      document.getElementById("voice").value = cfg.voice || "alloy";
      document.getElementById("background").value = cfg.background || "default";
      document.getElementById("avatar").value = cfg.avatar || "neo";
    });
  </script>
</body>
</html>
